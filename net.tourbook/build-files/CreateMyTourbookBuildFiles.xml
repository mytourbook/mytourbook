<?xml version="1.0" encoding="UTF-8"?>

<project name="create-build-files" default="create-build-files" basedir="..">

	<!--
		copy all project and language files from "mytourbook" into the build folder "mytourbook-BUILD-temp"
	-->

	<property name="path-mt-trunk"								value="../../mytourbook" />
	<property name="path-mt-trunk.nl"							value="../../mytourbook/LANGUAGE-FRAGMENTS" />

	<property name="path-o_synce-Macro-Plugin-for-MyTourbook"	value="../../o_synce-Macro-Plugin-for-MyTourbook" />
	<property name="path-O-Synce-Macro-Java-Interface"			value="../../O-Synce-Macro-Java-Interface" />

	<property name="path-mt-build"								value="../../../mytourbook-BUILD-autocreated" />

	<property name="path-build-core"							value="${path-mt-build}/core" />
	<property name="path-build-translation"						value="${path-mt-build}/translation" />

	<!--
		DEFAULT target
	-->
	<target name="create-build-files">

		<!-- 
			delete all build files
		 -->
		<antcall target="delete-all-build-files" />

		<!-- 
			copy core files 
		-->
		<antcall target="copy-core-files" />

		<!-- 
			copy language fragments 
		-->
		<antcall target="copy-language-fragments" />

		<!-- 
			copy language files 
		-->
		<antcall target="copy-language-files" />

	</target>

	<target name="delete-all-build-files">

		<!-- delete old build files: ${path-mt-build} -->
		<echo message="delete old build files: ${path-mt-build}" />

		<delete includeemptydirs="true" quiet="true">
			<fileset dir="${path-mt-build}" includes="**/*" />
		</delete>

	</target>

	<target name="copy-core-files">

		<echo message="copy core files into ${path-build-core}" />

		<copy todir="${path-build-core}" preservelastmodified="true" includeemptydirs="false">

		<!--
		-->
			<fileset dir="${path-mt-trunk}">

				<include name="net.tourbook*/**/*" />
				<include name="de.byteholder*/**/*" />
				<include name="org.apache.derby*/**" />
				
				<exclude name="**/plugin_*.properties" />
				<exclude name="**/feature_*.properties" />
				<exclude name="**/messages_*.properties" />

				<exclude name="**/bin/**" />
				<exclude name="**/classes/**" />

				<!-- ignore empty files -->
				<size value="0" when="more" />

			</fileset>

			<fileset dir="${path-o_synce-Macro-Plugin-for-MyTourbook}">

				<!-- copy only the plugin and not the feature -->
				<include name="net.tourbook.device.osynce.macro*/**/*" />
				
				<exclude name="**/bin/**" />
				<exclude name="**/classes/**" />

				<!-- ignore empty files -->
				<size value="0" when="more" />

			</fileset>

			<fileset dir="${path-O-Synce-Macro-Java-Interface}">

				<include name="de.akuz.osynce.macro*/**/*" />
				
				<exclude name="**/bin/**" />
				<exclude name="**/classes/**" />

				<!-- ignore empty files -->
				<size value="0" when="more" />

			</fileset>

		</copy>

	</target>

	<target name="copy-language-fragments">

		<echo message="copy language fragments into ${path-build-translation}" />

		<copy todir="${path-build-translation}" preservelastmodified="true" includeemptydirs="false">
			<fileset dir="${path-mt-trunk.nl}" >
				<include name="**/*" />
				<exclude name="**/z-DUMMY-HOST*/**" />
			</fileset>
		</copy>

	</target>

	<target name="copy-language-files">

		<echo message="copy language property files into ${path-build-translation}" />

		<copy todir="${path-build-translation}/" preservelastmodified="true" includeemptydirs="false">

			<fileset dir="${path-mt-trunk}">

				<include name="**/plugin_*.properties" />
				<include name="**/messages_*.properties" />

				<exclude name="**/bin/**" />
				<exclude name="**/classes/**" />

				<!-- ignore empty files -->
				<size value="0" when="more" />

			</fileset>

			<mapper>
				<regexpmapper from="^(de\.byteholder[^\\]*)(.*)$$" to="\1\.nl\2" />
				<regexpmapper from="^(net\.tourbook[^\\]*)(.*)$$" to="\1\.nl\2" />
			</mapper>

		</copy>

	</target>


</project>
