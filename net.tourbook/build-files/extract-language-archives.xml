<?xml version="1.0" encoding="UTF-8"?>

<project name="create-translation-file" default="unzip-all-archives" basedir="..">

	<!--
		extract language files from the archive into the trunk projects
	-->

	<property name="path-mt-trunk" value=".." />

	<!-- PRODUCTION TARGET
	-->
	<property name="path-language-target" value="${path-mt-trunk}" />
	
	<!-- DEBUG TARGET
	<property name="path-language-target" value="../../mytourbook-LANGUAGE-TEMP-trunk" />
	-->

	<property name="path-language-target-temp" value="../../mytourbook-LANGUAGE-TEMP" />
	<property name="path-language-archive" value="${path-mt-trunk}/../mytourbook-LANGUAGE-archives" />

	<!--
		DEFAULT target
	-->
	<target name="unzip-all-archives">

		<!-- delete temp dir -->
		<echo message="delete temp dir: ${path-language-target-temp}" />
		<delete includeemptydirs="true" quiet="true">
			<fileset dir="${path-language-target-temp}" includes="**/*" />
		</delete>

		<!-- 
			unzip archive: mt-de.zip 
		<antcall target="unzip-archive-for-one-language">
			<param name="archive-language" value="de" />
		</antcall>
		-->

		<!-- 
			unzip archive: mt-fr.zip 
		<antcall target="unzip-archive-for-one-language">
			<param name="archive-language" value="fr" />
		</antcall>
		-->
 
		<!-- 
			unzip archive: mt-nl.zip 
		-->
		<antcall target="unzip-archive-for-one-language">
			<param name="archive-language" value="nl" />
		</antcall>
 
		<!-- delete temp dir -->
		<echo message="delete temp dir: ${path-language-target-temp}" />
		<delete includeemptydirs="true" quiet="true">
			<fileset dir="${path-language-target-temp}" includes="**/*" />
		</delete>

	</target>


	<target name="unzip-archive-for-one-language">

		<!--
		<echo message="expand archive into ${path-language-target}" />
		-->
		<unzip src="${path-language-archive}/mt-${archive-language}.zip" dest="${path-language-target-temp}">

			<patternset>
				<include name="**/*${archive-language}.properties" /> 
				<exclude name="**/bin/**/*" /> 
			</patternset>

		</unzip>


		<!--
		<echo message="copy language files into the TRUNK projects  />
		-->
		<copy todir="${path-language-target}" overwrite="true" verbose="true" includeemptydirs="false">

			<fileset dir="${path-language-target-temp}" includes="**/*">
				<!-- ignore empty files -->
				<size value="0" when="more" />
			</fileset>

			<mapper>
				<regexpmapper from="^(.*)\.nl\\(.*)$$" to="\1\\\2" />
			</mapper>

		</copy>

	</target>

</project>
